<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIMETABA - SMASAMETA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');

        :root {
            --primary: #2563eb;
            --bg-grid: #f8fafc;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #ffffff;
            overflow-x: hidden;
            color: #1e293b;
        }

        .grid-bg {
            background-image: radial-gradient(#e2e8f0 1.5px, transparent 1.5px);
            background-size: 30px 30px;
            background-attachment: fixed;
        }

        .sidebar { transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .main-content { transition: margin-left 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .sidebar-closed { transform: translateX(-100%); }
        @media (min-width: 1024px) { .main-shifted { margin-left: 0 !important; } }

        .nav-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .nav-btn.active { background: #eff6ff; color: #2563eb; transform: translateX(5px); }
        .nav-btn.inactive { color: #94a3b8; }
        .nav-btn.inactive:hover { background: #f8fafc; color: #64748b; }

        .modern-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid #f1f5f9;
            border-radius: 2rem;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .modern-card:hover { transform: translateY(-8px); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.08); }

        .input-field {
            width: 100%;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 1rem;
            border: 2px solid transparent;
            font-weight: 600;
            transition: all 0.3s;
        }

        .input-field:focus { border-color: #bfdbfe; background: white; outline: none; box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.05); }

        #notification-container { position: fixed; top: 24px; right: 24px; z-index: 1000; pointer-events: none; }

        .toast {
            pointer-events: auto;
            background: white;
            padding: 16px 24px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
            transform: translateX(150%);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .toast.show { transform: translateX(0); }

        #login-overlay {
            position: fixed;
            inset: 0;
            background: white;
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-box {
            width: 100%;
            max-width: 420px;
            background: white;
            padding: 40px;
            border-radius: 2.5rem;
            border: 1px solid #f1f5f9;
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.05);
            text-align: center;
        }

        .section-animate { animation: slideIn 0.5s ease-out forwards; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .guide-box {
            background: #f8fafc;
            border-left: 4px solid #2563eb;
            padding: 1.25rem;
            border-radius: 0.75rem;
            margin-bottom: 2rem;
            text-align: left;
        }
    </style>
</head>
<body class="grid-bg">

    <!-- LOGIN SCREEN -->
    <div id="login-overlay">
        <div class="login-box">
            <img src="https://smasa-magetan.sch.id/wp-content/uploads/2023/06/LOGO-SMA-NEGERI-1-MAGETAN.png" alt="SMASA" class="w-20 mx-auto mb-6">
            <h2 class="text-2xl font-black text-slate-900 mb-2 uppercase">SIMETABA</h2>
            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-8">Masuk dengan NIS Anda</p>
            
            <div class="space-y-4">
                <input type="text" id="login-nis" placeholder="Masukkan NIS Anda" class="input-field text-center">
                <button onclick="handleLogin()" class="w-full py-4 bg-blue-600 text-white font-black rounded-2xl shadow-xl shadow-blue-100 transition-all hover:scale-[1.02]">MASUK KE SISTEM</button>
            </div>
            <p class="mt-8 text-[10px] text-slate-400 font-bold uppercase tracking-wider">SMAN 1 MAGETAN - OFFICIAL SYSTEM</p>
        </div>
    </div>

    <div id="notification-container"></div>

    <!-- MOBILE OVERLAY -->
    <div id="sidebar-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-[90] hidden"></div>

    <!-- SIDEBAR -->
    <aside id="sidebar" class="sidebar fixed inset-y-0 left-0 w-72 bg-white z-[100] border-r border-slate-100 p-6 flex flex-col translate-x-0">
        <button onclick="toggleSidebar()" class="absolute top-6 right-4 p-2 text-slate-400 hover:text-slate-900">
            <i data-lucide="x-circle" class="w-6 h-6"></i>
        </button>

        <div class="flex items-center gap-3 mb-8 px-2 mt-4">
            <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-100">
                <i data-lucide="shield-check" class="text-white w-6 h-6"></i>
            </div>
            <div>
                <h2 class="text-lg font-black text-slate-900 leading-none uppercase">SIMETABA</h2>
                <p class="text-[9px] font-extrabold text-blue-500 uppercase tracking-widest mt-1">SMASAMETA Hub</p>
            </div>
        </div>

        <div class="bg-slate-50 rounded-[1.5rem] p-5 text-center mb-6 border border-slate-100">
            <div id="side-initial" class="w-14 h-14 bg-blue-100 text-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-3 font-black text-xl shadow-inner">?</div>
            <h4 id="side-nama" class="font-bold text-slate-900 text-sm leading-tight mb-1 truncate">Profil Belum Diatur</h4>
            <p id="side-kelas" class="text-[9px] font-extrabold text-blue-500 uppercase mb-1">Status: Siswa</p>
            <p id="side-nis" class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">NIS: -</p>
        </div>

        <nav class="space-y-1 flex-grow">
            <button onclick="showSection('dashboard')" class="nav-btn active w-full" id="btn-dashboard">
                <i data-lucide="layout-dashboard" class="w-5 h-5"></i> Dashboard
            </button>
            <button onclick="showSection('profil')" class="nav-btn inactive w-full" id="btn-profil">
                <i data-lucide="user-check" class="w-5 h-5"></i> Edit Profil
            </button>
            <button onclick="showSection('lapor-hilang')" class="nav-btn inactive w-full" id="btn-lapor-hilang">
                <i data-lucide="search" class="w-5 h-5"></i> Lapor Kehilangan
            </button>
            <button onclick="showSection('lapor-titipan')" class="nav-btn inactive w-full" id="btn-lapor-titipan">
                <i data-lucide="archive" class="w-5 h-5"></i> Lapor Penitipan
            </button>
        </nav>

        <button onclick="handleLogout()" class="mt-4 flex items-center gap-3 p-4 text-red-500 font-bold text-sm hover:bg-red-50 rounded-xl transition-all">
            <i data-lucide="log-out" class="w-5 h-5"></i> Keluar Sistem
        </button>
    </aside>

    <!-- MAIN CONTENT -->
    <main id="main-content" class="main-content lg:ml-72 min-h-screen p-4 lg:p-10 flex flex-col">
        <header class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-10 bg-white/70 backdrop-blur-xl p-6 lg:p-8 rounded-[2rem] lg:rounded-[2.5rem] border border-slate-100 shadow-sm">
            <div class="flex items-center gap-5">
                <button onclick="toggleSidebar()" class="w-12 h-12 bg-white rounded-xl flex items-center justify-center border border-slate-100 text-slate-600 shadow-sm hover:bg-slate-50">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
                <img src="https://smasa-magetan.sch.id/wp-content/uploads/2023/06/LOGO-SMA-NEGERI-1-MAGETAN.png" alt="SMASA" class="w-12 h-12 lg:w-16 lg:h-16 object-contain">
                <div>
                    <h1 class="text-xl lg:text-2xl font-black text-slate-900 uppercase leading-none">SIMETABA</h1>
                    <p class="text-[10px] lg:text-xs font-bold text-slate-400 mt-2 italic">Official SMASAMETA Assets Management</p>
                </div>
            </div>
            
            <div class="hidden md:flex items-center gap-4 bg-white px-6 py-3 rounded-[1.5rem] shadow-sm border border-slate-50">
                <div class="text-right">
                    <p class="text-sm font-black text-slate-800" id="top-nama">Siswa SMASAMETA</p>
                    <p class="text-[10px] font-bold text-slate-400 uppercase" id="top-nis">NIS: -</p>
                </div>
                <div class="w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center text-white font-black text-xl shadow-lg shadow-blue-100" id="top-initial">S</div>
            </div>
        </header>

        <!-- Section Dashboard -->
        <section id="section-dashboard" class="section-animate">
            <div class="bg-white p-8 rounded-[2.5rem] border border-slate-100 mb-10 shadow-sm">
                <h3 class="text-xl font-black text-slate-900 mb-4 flex items-center gap-3 uppercase">
                    <i data-lucide="info" class="text-blue-500"></i> Informasi Platform
                </h3>
                <p class="text-sm text-slate-600 leading-relaxed text-justify">
                    <b>SIMETABA</b> merupakan platform digital yang dikembangkan untuk mendukung pengelolaan penitipan serta pelaporan barang hilang dan temuan di lingkungan <b>SMASAMETA</b>. Melalui sistem ini, pengguna dapat mencatat penitipan barang, melaporkan kehilangan, serta menelusuri informasi barang yang ditemukan secara terstruktur, cepat, dan transparan.
                </p>
            </div>

            <div class="mb-8 flex flex-col md:flex-row gap-4 items-center justify-between">
                <div class="relative w-full max-w-xl">
                    <i data-lucide="search" class="absolute left-5 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5"></i>
                    <input type="text" id="search-input" onkeyup="renderDashboard()" placeholder="Cari barang berdasarkan nama..." class="w-full pl-14 pr-6 py-4 rounded-2xl border border-slate-100 outline-none focus:ring-4 focus:ring-blue-50 transition-all font-semibold shadow-sm">
                </div>
                <div class="flex gap-2 w-full md:w-auto overflow-x-auto pb-2">
                    <button onclick="setFilter('ALL')" id="f-all" class="flex-shrink-0 px-6 py-2.5 rounded-full text-[10px] font-black uppercase bg-blue-600 text-white shadow-md">Semua</button>
                    <button onclick="setFilter('HILANG')" id="f-hilang" class="flex-shrink-0 px-6 py-2.5 rounded-full text-[10px] font-black uppercase bg-white border border-slate-100 text-slate-400 hover:border-red-200">Kehilangan</button>
                    <button onclick="setFilter('TITIPAN')" id="f-titipan" class="flex-shrink-0 px-6 py-2.5 rounded-full text-[10px] font-black uppercase bg-white border border-slate-100 text-slate-400 hover:border-blue-200">Penitipan</button>
                </div>
            </div>

            <div id="report-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 lg:gap-8">
                <!-- Cards render here -->
            </div>
        </section>

        <!-- Section Profil -->
        <section id="section-profil" class="hidden section-animate max-w-2xl mx-auto w-full">
            <div class="bg-white p-6 lg:p-10 rounded-[2rem] lg:rounded-[2.5rem] shadow-sm border border-slate-100">
                <div class="flex items-center gap-4 mb-8">
                    <div class="w-12 h-12 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center">
                        <i data-lucide="user-pen" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <h3 class="text-2xl font-black">Identitas Diri</h3>
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">Wajib diisi sebelum melapor</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-8">
                    <div class="md:col-span-2">
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-2 block">Nama Lengkap</label>
                        <input type="text" id="v-nama" placeholder="Gunakan Nama Asli" class="input-field">
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-2 block">Kelas</label>
                        <select id="v-kelas" class="input-field">
                            <option value="">Pilih Kelas</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-2 block">No. WhatsApp Aktif</label>
                        <input type="tel" id="v-wa" placeholder="Contoh: 08123456789" class="input-field">
                    </div>
                </div>
                <button onclick="saveProfile()" class="w-full py-5 bg-blue-600 text-white font-black rounded-2xl shadow-xl uppercase tracking-widest">SIMPAN PROFIL</button>
            </div>
        </section>

        <!-- Section Lapor Hilang -->
        <section id="section-lapor-hilang" class="hidden section-animate max-w-3xl mx-auto w-full">
            <div class="bg-white p-6 lg:p-10 rounded-[2rem] lg:rounded-[2.5rem] shadow-sm border border-slate-100">
                <div class="flex items-center gap-4 mb-6">
                    <div class="w-12 h-12 bg-red-50 text-red-500 rounded-2xl flex items-center justify-center">
                        <i data-lucide="search" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <h3 class="text-2xl font-black">Lapor Barang Hilang</h3>
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">Informasikan barang Anda yang hilang</p>
                    </div>
                </div>

                <div class="guide-box border-red-500 bg-red-50">
                    <h5 class="text-[11px] font-black text-red-600 uppercase mb-3 flex items-center gap-2">
                        <i data-lucide="alert-triangle" class="w-4 h-4"></i> Panduan Lapor Hilang
                    </h5>
                    <ul class="text-[11px] text-red-800 font-bold space-y-2">
                        <li class="flex gap-2"><span>1.</span><span>Berikan nama barang yang spesifik (contoh: Dompet Coklat Merk Levi's).</span></li>
                        <li class="flex gap-2"><span>2.</span><span>Pilih kategori yang paling sesuai agar mempermudah pencarian.</span></li>
                        <li class="flex gap-2"><span>3.</span><span>Sebutkan lokasi terakhir barang terlihat atau diperkirakan hilang.</span></li>
                        <li class="flex gap-2"><span>4.</span><span>Link foto bersifat opsional namun sangat disarankan untuk identifikasi visual.</span></li>
                    </ul>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-8">
                    <div class="md:col-span-2">
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-2 block">Nama Barang</label>
                        <input type="text" id="lh-nama" placeholder="Misal: Jaket Hitam Polos" class="input-field">
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-2 block">Kategori</label>
                        <select id="lh-kat" class="input-field">
                            <option value="Elektronik">Elektronik</option>
                            <option value="Peralatan">Peralatan</option>
                            <option value="Aksesoris">Aksesoris</option>
                            <option value="Lainnya">Lainnya</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-2 block">Lokasi Perkiraan Hilang</label>
                        <input type="text" id="lh-lok" placeholder="Misal: Lapangan Basket" class="input-field">
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-2 block">Tanggal Kejadian</label>
                        <input type="date" id="lh-tgl" class="input-field">
                    </div>
                    <div class="md:col-span-2">
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-2 block">Link Foto G-Drive (Opsional)</label>
                        <input type="text" id="lh-foto" placeholder="Contoh: https://drive.google.com/file/d/..." class="input-field">
                    </div>
                </div>
                <button onclick="submitReport('HILANG')" class="w-full py-5 bg-red-500 text-white font-black rounded-2xl shadow-xl uppercase tracking-widest">KIRIM LAPORAN KEHILANGAN</button>
            </div>
        </section>

        <!-- Section Lapor Penitipan -->
        <section id="section-lapor-titipan" class="hidden section-animate max-w-3xl mx-auto w-full">
            <div class="bg-white p-6 lg:p-10 rounded-[2rem] lg:rounded-[2.5rem] shadow-sm border border-slate-100">
                <div class="flex items-center gap-4 mb-6">
                    <div class="w-12 h-12 bg-blue-50 text-blue-500 rounded-2xl flex items-center justify-center">
                        <i data-lucide="archive" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <h3 class="text-2xl font-black">Lapor Barang Titipan</h3>
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">Barang temuan yang diserahkan ke Piket/Lobby</p>
                    </div>
                </div>

                <div class="guide-box border-blue-500 bg-blue-50">
                    <h5 class="text-[11px] font-black text-blue-600 uppercase mb-3 flex items-center gap-2">
                        <i data-lucide="info" class="w-4 h-4"></i> Panduan Lapor Penitipan (Temuan)
                    </h5>
                    <ul class="text-[11px] text-blue-800 font-bold space-y-2">
                        <li class="flex gap-2"><span>1.</span><span>Laporan ini khusus untuk barang temuan yang dititipkan di pusat informasi (Piket).</span></li>
                        <li class="flex gap-2"><span>2.</span><span>Harap isi lokasi penyimpanan sekarang dengan detail (contoh: Laci Kanan Meja Piket).</span></li>
                        <li class="flex gap-2"><span>3.</span><span>Sangat disarankan menyertakan foto agar pemilik asli bisa melakukan klaim.</span></li>
                        <li class="flex gap-2"><span>4.</span><span>Pastikan data yang dimasukkan benar dan dapat dipertanggungjawabkan.</span></li>
                    </ul>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-8">
                    <div class="md:col-span-2">
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-2 block">Barang Yang Ditemukan</label>
                        <input type="text" id="lt-nama" placeholder="Misal: Flashdisk Biru" class="input-field">
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-2 block">Lokasi Penyimpanan Sekarang</label>
                        <input type="text" id="lt-lok" placeholder="Misal: Meja Piket Depan" class="input-field">
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-2 block">Tanggal Ditemukan</label>
                        <input type="date" id="lt-tgl" class="input-field">
                    </div>
                    <div class="md:col-span-2">
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2 mb-2 block">Link Foto G-Drive (Opsional)</label>
                        <input type="text" id="lt-foto" placeholder="Contoh: https://drive.google.com/file/d/..." class="input-field">
                    </div>
                </div>
                <button onclick="submitReport('TITIPAN')" class="w-full py-5 bg-blue-600 text-white font-black rounded-2xl shadow-xl uppercase tracking-widest">SIMPAN DATA PENITIPAN</button>
            </div>
        </section>

        <!-- Minimal Footer -->
        <footer class="mt-auto py-12 border-t border-slate-100">
            <div class="max-w-4xl mx-auto text-center px-6">
                <p class="text-[10px] font-black text-slate-300 uppercase tracking-[0.4em]">SIMETABA DIGITAL HUB â€¢ SMASAMETA OFFICIAL</p>
            </div>
        </footer>
    </main>

    <script>
        const DEFAULT_IMG_LINK = "https://drive.google.com/file/d/1JYllyefa7DdxGQUf-5WYeC5_rx55zSl2/view?usp=drive_link";
        
        let currentUser = { nama: "Siswa SMASAMETA", nis: "-", kelas: "Siswa", wa: "", isVerified: false };
        let filter = 'ALL';
        let barangList = [
            {
                id: 'BRG-001',
                status: 'TITIPAN',
                namaBarang: 'Kunci Motor NMAX',
                kategori: 'Aksesoris',
                tanggal: '2024-05-20',
                lokasi: 'Meja Piket Lobby',
                foto: fixDriveLink(DEFAULT_IMG_LINK),
                pelapor: 'Admin SIMETABA',
                nis: '0001',
                wa: '628123456789'
            }
        ];

        function initClasses() {
            const select = document.getElementById('v-kelas');
            const levels = ['X', 'XI', 'XII'];
            levels.forEach(lvl => {
                for(let i=1; i<=10; i++) {
                    const opt = document.createElement('option');
                    opt.value = `${lvl}.${i}`;
                    opt.textContent = `${lvl}.${i}`;
                    select.appendChild(opt);
                }
            });
        }

        function handleLogin() {
    const nisInput = document.getElementById('login-nis').value.trim();

    if (nisInput === "") {
        showNotification("Masukkan NIS terlebih dahulu!", "error");
        return;
    }

    currentUser.nis = nisInput;
    document.getElementById('login-overlay').style.display = "none";

    updateUI();
    showNotification("Berhasil Masuk ke SIMETABA!");
}

        function handleLogout() {
            location.reload();
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const main = document.getElementById('main-content');
            const overlay = document.getElementById('sidebar-overlay');
            
            sidebar.classList.toggle('sidebar-closed');
            main.classList.toggle('main-shifted');
            
            if(window.innerWidth < 1024) {
                overlay.classList.toggle('hidden');
            }
        }

        function fixDriveLink(url) {
            if(!url) return "";
            if(url.includes('drive.google.com')) {
                let id = "";
                if(url.includes('/d/')) id = url.split('/d/')[1].split('/')[0];
                else if(url.includes('id=')) id = url.split('id=')[1].split('&')[0];
                return id ? `https://lh3.googleusercontent.com/u/0/d/${id}` : url;
            }
            return url;
        }

        function showNotification(msg, type='success') {
            const container = document.getElementById('notification-container');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `
                <div class="w-8 h-8 ${type === 'success' ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'} rounded-full flex items-center justify-center">
                    <i data-lucide="${type === 'success' ? 'check' : 'alert-circle'}" class="w-4 h-4"></i>
                </div>
                <p class="text-sm font-bold text-slate-700">${msg}</p>
            `;
            container.appendChild(toast);
            lucide.createIcons();
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 400);
            }, 3000);
        }

        function saveProfile() {
            const nama = document.getElementById('v-nama').value;
            const kelas = document.getElementById('v-kelas').value;
            let wa = document.getElementById('v-wa').value;

            if(!nama || !kelas || !wa) {
                showNotification("Lengkapi semua data profil!", "error");
                return;
            }

            if(wa.startsWith('0')) wa = '62' + wa.slice(1);
            else if(!wa.startsWith('62')) wa = '62' + wa;

            currentUser.nama = nama;
            currentUser.kelas = kelas;
            currentUser.wa = wa;
            currentUser.isVerified = true;

            updateUI();
            showNotification("Profil berhasil disimpan!");
            showSection('dashboard');
        }

        function updateUI() {
            document.getElementById('side-nama').innerText = currentUser.nama;
            document.getElementById('side-nis').innerText = 'NIS: ' + currentUser.nis;
            document.getElementById('side-kelas').innerText = 'Kelas: ' + currentUser.kelas;
            document.getElementById('side-initial').innerText = currentUser.nama.charAt(0).toUpperCase();
            
            document.getElementById('top-nama').innerText = currentUser.nama;
            document.getElementById('top-nis').innerText = 'NIS: ' + currentUser.nis;
            document.getElementById('top-initial').innerText = currentUser.nama.charAt(0).toUpperCase();
        }

        function showSection(id) {
            const sections = ['dashboard', 'profil', 'lapor-hilang', 'lapor-titipan'];
            sections.forEach(s => {
                document.getElementById('section-' + s).classList.add('hidden');
                document.getElementById('btn-' + s).classList.replace('active', 'inactive');
            });
            document.getElementById('section-' + id).classList.remove('hidden');
            document.getElementById('btn-' + id).classList.replace('inactive', 'active');
            
            if(window.innerWidth < 1024 && !document.getElementById('sidebar').classList.contains('sidebar-closed')) {
                toggleSidebar();
            }
            lucide.createIcons();
        }

        function setFilter(f) {
            filter = f;
            ['all', 'hilang', 'titipan'].forEach(id => {
                document.getElementById('f-'+id).className = "flex-shrink-0 px-6 py-2.5 rounded-full text-[10px] font-black uppercase bg-white border border-slate-100 text-slate-400 hover:border-blue-200";
            });
            document.getElementById('f-'+f.toLowerCase()).className = "flex-shrink-0 px-6 py-2.5 rounded-full text-[10px] font-black uppercase bg-blue-600 text-white shadow-md";
            renderDashboard();
        }

        function submitReport(type) {
            if(!currentUser.isVerified) {
                showNotification("Harap lengkapi profil Anda!", "error");
                showSection('profil');
                return;
            }

            const prefix = type === 'HILANG' ? 'lh' : 'lt';
            const nama = document.getElementById(`${prefix}-nama`).value;
            const lok = document.getElementById(`${prefix}-lok`).value;
            const tgl = document.getElementById(`${prefix}-tgl`).value;
            const rawFoto = document.getElementById(`${prefix}-foto`).value || DEFAULT_IMG_LINK;
            
            if(!nama || !lok || !tgl) {
                showNotification("Field wajib tidak boleh kosong!", "error");
                return;
            }

            const newBarang = {
                id: 'BRG-' + Math.floor(Math.random() * 900 + 100),
                status: type,
                namaBarang: nama,
                kategori: type === 'HILANG' ? document.getElementById('lh-kat').value : 'Temuan',
                tanggal: tgl,
                lokasi: lok,
                foto: fixDriveLink(rawFoto),
                pelapor: currentUser.nama,
                nis: currentUser.nis,
                wa: currentUser.wa
            };

            barangList.unshift(newBarang);
            renderDashboard();
            showNotification("Laporan berhasil dikirim!");
            showSection('dashboard');

            document.getElementById(`${prefix}-nama`).value = "";
            document.getElementById(`${prefix}-foto`).value = "";
        }

        function renderDashboard() {
            const grid = document.getElementById('report-grid');
            const search = document.getElementById('search-input').value.toLowerCase();
            
            let filtered = barangList.filter(b => 
                (filter === 'ALL' || b.status === filter) && 
                b.namaBarang.toLowerCase().includes(search)
            );

            grid.innerHTML = filtered.map(b => `
                <div class="modern-card">
                    <div class="h-48 relative overflow-hidden">
                        <img src="${b.foto}" class="w-full h-full object-cover">
                        <div class="absolute top-4 left-4">
                            <span class="px-3 py-1 rounded-full text-[8px] font-black uppercase ${b.status === 'HILANG' ? 'bg-red-500 text-white' : 'bg-blue-600 text-white'} shadow-lg">
                                ${b.status}
                            </span>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-2">
                            <p class="text-[9px] font-black text-blue-500 uppercase">${b.kategori}</p>
                            <p class="text-[9px] font-bold text-slate-300">#${b.id}</p>
                        </div>
                        <h4 class="text-lg font-black text-slate-900 mb-4 truncate">${b.namaBarang}</h4>
                        
                        <div class="space-y-2 mb-6 text-[11px] font-bold text-slate-400">
                            <div class="flex items-center gap-2">
                                <i data-lucide="map-pin" class="w-3 h-3 text-blue-500"></i>
                                <span>${b.lokasi}</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i data-lucide="calendar" class="w-3 h-3 text-blue-500"></i>
                                <span>${b.tanggal}</span>
                            </div>
                        </div>

                        <div class="flex items-center justify-between pt-4 border-t border-slate-50">
                            <div class="flex items-center gap-2">
                                <div class="w-8 h-8 bg-blue-50 text-blue-600 rounded-lg flex items-center justify-center text-[10px] font-black">
                                    ${b.pelapor.charAt(0)}
                                </div>
                                <div class="leading-none">
                                    <p class="text-[10px] font-black text-slate-800">${b.pelapor}</p>
                                    <p class="text-[8px] font-bold text-slate-400 mt-1 uppercase">NIS: ${b.nis}</p>
                                </div>
                            </div>
                            <a href="https://wa.me/${b.wa}" target="_blank" class="px-3 py-2 bg-green-500 text-white text-[9px] font-black rounded-lg uppercase flex items-center gap-1.5 shadow-md hover:bg-green-600 transition-all active:scale-95">
                                <i class="fab fa-whatsapp"></i> Hubungi
                            </a>
                        </div>
                    </div>
                </div>
            `).join('');
            
            if(filtered.length === 0) {
                grid.innerHTML = `<div class="col-span-full py-20 text-center font-bold text-slate-300 uppercase tracking-widest">Data barang tidak ditemukan</div>`;
            }

            lucide.createIcons();
        }

        window.onload = () => {
            initClasses();
            lucide.createIcons();
            renderDashboard();
        };
    </script>
    <script>

const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbx-myzAzt3LtKoCLDr7AlKVPK5AultD5Wya4T0psCyo_tw7cYXYf1K1XabWYCgARGdGyQ/exec";

async function sendToGas(action, payload){
    const res = await fetch(WEB_APP_URL, {
        method: "POST",
        headers: {
            "Content-Type": "text/plain;charset=utf-8"
        },
        body: JSON.stringify({
            action: action,
            ...payload
        })
    });

    return await res.json();
}

// Ambil data barang dari Spreadsheet
async function loadBarangFromServer(){
    const result = await sendToGas("getBarang", {});
    if(result && result.data){
        barangList = result.data;
        renderDashboard();
    }
}

// Override submit agar kirim ke GAS
async function submitReport(type){
    if(!currentUser.isVerified){
        showNotification("Harap lengkapi profil Anda!", "error");
        showSection('profil');
        return;
    }

    const prefix = type === 'HILANG' ? 'lh' : 'lt';

    const payload = {
        status: type,
        namaBarang: document.getElementById(`${prefix}-nama`).value,
        kategori: type === 'HILANG' ? document.getElementById('lh-kat').value : "Temuan",
        lokasi: document.getElementById(`${prefix}-lok`).value,
        tanggal: document.getElementById(`${prefix}-tgl`).value,
        foto: document.getElementById(`${prefix}-foto`).value,
        nama: currentUser.nama,
        nis: currentUser.nis,
        wa: currentUser.wa
    };

    const result = await sendToGas("addBarang", payload);

    if(result.status === "success"){
        showNotification("Tersimpan ke Spreadsheet!");
        loadBarangFromServer();
        showSection('dashboard');
    }else{
        showNotification("Gagal kirim data", "error");
    }
}

// Load data saat masuk
window.onload = () => {
    initClasses();
    lucide.createIcons();
    loadBarangFromServer();
};

async function submitReport(type) {
    if (!currentUser.isVerified) {
        showNotification("Harap lengkapi profil Anda!", "error");
        showSection('profil');
        return;
    }

    const prefix = type === 'HILANG' ? 'lh' : 'lt';
    
    // Pastikan ID elemen ini ada di HTML Anda (lh-nama, lt-nama, dll)
    const namaBarang = document.getElementById(`${prefix}-nama`).value;
    const lokasi = document.getElementById(`${prefix}-lok`).value;
    const tanggal = document.getElementById(`${prefix}-tgl`).value;
    const foto = document.getElementById(`${prefix}-foto`).value || "";

    if (!namaBarang || !lokasi || !tanggal) {
        showNotification("Mohon isi semua kolom wajib!", "error");
        return;
    }

    const formData = new URLSearchParams();
    formData.append('action', 'addBarang');
    formData.append('status', type);
    formData.append('namaBarang', namaBarang);
    formData.append('kategori', type === 'HILANG' ? document.getElementById('lh-kat').value : "Temuan");
    formData.append('lokasi', lokasi);
    formData.append('tanggal', tanggal);
    formData.append('foto', foto);
    formData.append('nama', currentUser.nama);
    formData.append('nis', currentUser.nis);
    formData.append('kelas', currentUser.kelas);
    formData.append('wa', currentUser.wa); // Ini akan masuk ke kolom 'Nomor' di Spreadsheet

    try {
        showNotification("Sedang mengirim...");
        
        await fetch(WEB_APP_URL, {
            method: "POST",
            mode: "no-cors", 
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: formData.toString()
        });
        
        showNotification("Data Berhasil Terkirim!");
        
        // Bersihkan form
        document.getElementById(`${prefix}-nama`).value = "";
        showSection('dashboard');
        loadBarangFromServer(); // Refresh data dashboard
        
    } catch (err) {
        showNotification("Koneksi gagal!", "error");
        console.error(err);
    }
}
</script>

</body>
</html>